function getUrlParameter(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function updateTableValues(t){if($("#tablecontainerDiv").html(" "),$("#tablecontainerDiv").html("<table id='data-table' class='table table-striped table-bordered display'  cellspacing=0 width=100%><thead class='Table_header'><tr><th name='local_inv_no' onclick='myFunctionSorting(this)'>Invoice #</th><th name='po_number' onclick='myFunctionSorting(this)'>PO Code</th><th name='lr_no' onclick='myFunctionSorting(this)'>LR Number</th><th name='customer_name' onclick='myFunctionSorting(this)'>Customer Name</th><th name='order_status' onclick='myFunctionSorting(this)'>Status</th><th name='pickup_city' onclick='myFunctionSorting(this)'>Origin</th><th name='delivery_city' onclick='myFunctionSorting(this)'>Destination</th><th name='current_location' onclick='myFunctionSorting(this)'>Latest Location</th><th name='booked_datetime' onclick='myFunctionSorting(this)'>Date Of Dispatch</th><th name='assured_delivery_date' onclick='myFunctionSorting(this)'>Expected Delivery Date</th><th name='pod_image_link' onclick='myFunctionSorting(this)'>POD</th><th>Feedback</th></tr></thead><tbody class='aboutMeTable_body'></tbody></table></div></section>"),$.each(t,function(t,e){var r="<tr>";r+="<td class='trackDetails' data-toggle='modal' data-target='#modal-report' style='text-align: center;'><span class='editrowCss'>"+e.invoice_value+"</span></td>",e.po_number?r+="<td style='text-align: center;'>"+e.po_number+"</td>":r+="<td></td>",r+="<td style='text-align: center;'>"+e.docket_number+"</td>",r+="<td style='text-align: center;'>"+e.customer_name+"</td>",e.status?r+="<td style='text-align: center;'>"+e.status+"</td>":r+="<td style='text-align: center;'>DISPATCH</td>",r+="<td style='text-align: center;'>"+e.pickup_city+"</td>",r+="<td style='text-align: center;'>"+e.delivery_city+"</td>",e.currentLocation.city?r+="<td style='text-align: center;'>"+e.currentLocation.city+"</td>":r+="<td style='text-align: center;'>"+e.pickup_city+"</td>",e.createdAt?r+="<td style='text-align: center;'>"+dateToYMD(new Date(e.createdAt))+"</td>":r+="<td></td>",e.estimatedTimeOfArrival?r+="<td style='text-align: center;'>"+dateToYMD(new Date(e.estimatedTimeOfArrival))+"</td>":r+="<td></td>",e.pod?r+="<td style='text-align: center;'><a target= '_blank' href="+e.pod+">"+e.pod+"</a></td>":r+="<td></td>",e.notificationNew,r+="<td style='text-align: center;'><span class='alertAndFeedBackSpan' title='Feedback'><a target= '_blank' href='https://goo.gl/forms/Fr33RtzyLwAicrkP2'><i class='fa fa-comments-o'></i></a></span></td>",r+="</tr>",$("#data-table tbody").append(r)}),viewMoreFunction(t),"initial"!==(r=JSON.parse(localStorage.getItem("objSorting"))).sortType){var e=r.sortType;e="sorting_desc"===e?"desc":"asc",$("#data-table").DataTable({dom:"lBfrtip",buttons:[{extend:"copy",className:"btn-sm"},{extend:"csv",className:"btn-sm"},{extend:"excel",className:"btn-sm"},{extend:"pdf",className:"btn-sm"},{extend:"print",className:"btn-sm"}],responsive:0,scrollX:!0,autoFill:0,colReorder:0,keys:0,rowReorder:0,select:0,order:[[r.getColomnIndex,e]]}),localStorage.removeItem("objSorting");var r={sortType:"initial",name:"",userId:"",getColomnIndex:""};localStorage.setItem("objSorting",JSON.stringify(r))}else TableManageCombine.init();handlePageContentView()}function dateToYMD(t){var e=t.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getFullYear();return(e<=9?"0"+e:e)+"-"+r+"-"+a}function getColomnIndexFunction(t){return"local_inv_no"===t?0:"po_number"===t?1:"lr_no"===t?2:"customer_name"===t?3:"order_status"===t?4:"pickup_city"===t?5:"delivery_city"===t?6:"current_location"===t?7:"booked_datetime"===t?8:"assured_delivery_date"===t?9:"pod_image_link"===t?10:"notification"===t?11:void 0}function updateUserWidgetValue(){var t=JSON.parse(localStorage.getItem("customerObj")),e={userId:t.customer_id,role:t.role,mainUrl:t.mainUrl};$.ajax({url:"/embed/getUserTotalCountById",type:"POST",datatype:"json",data:e,async:!0,success:function(t){"Ok"===t.resCode?updateUserWidgetValuesNew(t.msg):console.log("Error executing AJAX request. Please contact your administrator")},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateUserWidgetValuesNew(t){var e,r=0,a=0,o=0,n=0;for(e=0;e<t.length;e++)"IN TRANSIT"===t[e].order_status?r=t[e].shipment_count:"DELIVERED"===t[e].order_status?a=t[e].shipment_count:"OUT FOR DELIVERY"===t[e].order_status?t[e].shipment_count:"ATTEMPTED"===t[e].order_status&&(o=t[e].shipment_count),null!==t[e].order_status&&(n+=t[e].shipment_count);var i=JSON.parse(localStorage.getItem("customerObj")),s={selectStatus:"DELAYED",userId:i.customer_id,role:i.role,mainUrl:i.mainUrl};$.ajax({url:"/embed/getDelayedById",type:"POST",datatype:"json",data:s,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(n),$("#inTransitShipment").html(r),$("#deliveredShipment").html(a),$("#attemptedShipment").html(o),$("#delayedShipment").html(t.msg.length)}},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function myFunctionSorting(t){$("#page-loader").removeClass("hide");var e=$(t).attr("class");e="sorting"===e?"sorting_asc":"sorting_desc"===e?"sorting_asc":"sorting_desc";var r=$(t).attr("name"),a=JSON.parse(localStorage.getItem("customerObj")),o=JSON.parse(localStorage.getItem("searchObj")),n=getColomnIndexFunction(r);if("initial"!=o.originCity)var i={sortType:e,name:r,userId:a.customer_id,role:a.user,getColomnIndex:n,originCity:o.originCity,invoiceNumber:o.invoiceNumber,LRNumber:o.LRNumber,dispatch:o.dispatch,estimated:o.estimated,selectStatus:o.selectStatus,customerNumber:o.customerNumber,mainUrl:a.mainUrl};else i={sortType:e,name:r,userId:a.customer_id,role:a.user,getColomnIndex:n,mainUrl:a.mainUrl};localStorage.setItem("objSorting",JSON.stringify(i)),$.ajax({url:"/embed/getRetailersById",type:"POST",datatype:"json",data:i,async:!0,success:function(t){"Ok"===t.resCode?(updateTableValues(t.msg),$("#page-loader").addClass("hide")):(console.log(t.msg),$("#tablecontainerDiv").html('<h1 style="text-align:center;">'+t.msg+"</h1>"),$("#page-loader").addClass("hide"))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function searchFunction(){$("#page-loader").removeClass("hide");var t=$("#originCity").val(),e=$("#invoiceNumber").val(),r=$("#LRNumber").val(),a=$("#dateRangepicker-Dispatch").val(),o=$("#dateRangepicker-Estimated").val(),n=document.getElementById("selectStatus").value,i=$("#customerNumber").val(),s=JSON.parse(localStorage.getItem("customerObj"));(""!=t||""!=e||""!=r||""!=a||""!=o||""!=n&&"Status"!=n||""!=i)&&$("#Filter").removeClass("hide");var l={originCity:t,invoiceNumber:e,LRNumber:r,selectStatus:n,userId:s.customer_id,customerNumber:i,dispatch:a,estimated:o,role:s.user,mainUrl:s.mainUrl};localStorage.setItem("searchObj",JSON.stringify(l)),$.ajax({url:"/embed/getRetailersById",type:"POST",datatype:"json",data:l,async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(console.log(t.msg),$("#tablecontainerDiv").html('<h1 style="text-align:center;">'+t.msg+"</h1>"),$("#page-loader").addClass("hide"))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function removeFilterFunction(){$("#originCity").val(""),$("#invoiceNumber").val(""),$("#LRNumber").val(""),$("#dateRangepicker-Dispatch").val(""),$("#dateRangepicker-Estimated").val(""),$("#selectStatus").val(""),$("#customerNumber").val("");$("#selectStatus").find("option[value=]").prop("selected",!0).trigger("change"),$("#Filter").addClass("hide"),$("#page-loader").removeClass("hide"),customerObj=JSON.parse(localStorage.getItem("customerObj")),localStorage.removeItem("objSorting");localStorage.setItem("objSorting",JSON.stringify({sortType:"initial",name:"",userId:"",getColomnIndex:""})),$.ajax({url:"/embed/getRetailersById",type:"POST",datatype:"json",data:{userId:customerObj.customer_id,role:customerObj.user,mainUrl:customerObj.mainUrl},async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(console.log(t.msg),$("#tablecontainerDiv").html('<h1 style="text-align:center;">'+t.msg+"</h1>"),$("#page-loader").addClass("hide"))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function viewMoreFunction(t){$(".trackDetails").click(function(e){for(var r=$(this).parents("tr").find("td:first").find("span").html(),a=($(this).parents("tr").find("td:nth-child(2)").html(),$(this).parents("tr").find("td:nth-child(3)").html()),o=($(this).parents("tr").find("td:nth-child(4)").html(),$(this).parents("tr").find("td:nth-child(5)").html(),{}),n=0;n<t.length;n++)if(t[n].invoice_value==r)o=t[n];$("#exampleModalLongTitle").html("View More About Invoice Number : "+r);var i;$("#modalBodyReport").html('<div class="centerAlignDiv"><table style="width:50%;min-width:300px;" id="viewMoreTable" class="table-bordered table-striped"><tr></table></div>'),i+="<tr><th>Invoice Number</th><td>"+o.invoice_value+"</td></tr>",i+="<tr><th>PO Code</th><td>",o.po_number?i+=o.po_number+"</td></tr>":i+="</td></tr>",i+="<tr><th>LR Number</th><td>"+o.docket_number+"</td></tr>",i+="<tr><th>Customer Name</th><td>"+o.customer_name+"</td></tr>",i+="<tr><th>Status</th><td>",o.status?i+=o.status+"</td></tr>":i+="DISPATCH</td></tr>",i+="<tr><th>Origin</th><td>"+o.pickup_city+"</td></tr>",i+="<tr><th>Destination</th><td>"+o.delivery_city+"</td></tr>",i+="<tr><th>Latest Location</th><td>",o.currentLocation.city?i+=o.currentLocation.city+"</td></tr>":i+=o.pickup_city+"</td></tr>",i+="<tr><th>Date Of Dispatch</th><td>",o.createdAt?i+=dateToYMD(new Date(o.createdAt))+"</td></tr>":i+="</td></tr>",i+="<tr><th>Expected Delivery Date</th><td>",o.estimatedTimeOfArrival?i+=dateToYMD(new Date(o.estimatedTimeOfArrival))+"</td></tr>":i+="</td></tr>",i+="<tr><th>POD</th>",o.pod?i+="<td><a target= '_blank' href="+o.pod+">"+o.pod+"</a></td></tr>":i+="<td></td></tr>",i+="<tr><th>Remark</th><td>",o.remark?i+=o.remark+"</td></tr>":i+="</td></tr>",$("#viewMoreTable").append(i);var s={lr_No:a,CustomerCode:o.account_number};$.ajax({url:"/route/viewMoreAndTraceNew",type:"POST",datatype:"json",data:s,async:!0,success:function(t){if("OK"==t.resCode)updateTracking(t.track,o);else{var e='<br><div class="centerAlignDiv"><ol class="progtrckr" data-progtrckr-steps="4"><li class="progtrckr-done">Dispatch ( '+moment(o.createdAt).format("YYYY-MM-DD")+' )</li><li class="progtrckr-todo">In Transit</li><li class="progtrckr-todo">Attempted</li><li class="progtrckr-todo">Delivered</li></ol></div><br>';$("#modalBodyReport").append(e),$("#loaderModal").addClass("hide"),$("#modalBodyReport").removeClass("hide")}},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})})}function updateTracking(t,e){var r,a="",o="",n="";for(r=0;r<t.length;r++)"IN TRANSIT"===t[r].order_status?a=t[r].last_delivery_status_date:"ATTEMPTED"===t[r].order_status?o=t[r].last_delivery_status_date:"DELIVERED"===t[r].order_status&&(n=t[r].last_delivery_status_date);""!=n?""==o&&(o=n,""==a&&(a=n)):""!=o&&""==a&&(a=o);var i='<br><div class="centerAlignDiv"><ol class="progtrckr" data-progtrckr-steps="4"><li class="progtrckr-done">Dispatch ( '+moment(e.createdAt).format("YYYY-MM-DD")+" )</li>";i+=a?'<li class="progtrckr-done">In Transit ( '+moment(a).format("YYYY-MM-DD")+" )</li>":'<li class="progtrckr-todo">In Transit</li>',i+=o?'<li class="progtrckr-done">Attempted ( '+moment(o).format("YYYY-MM-DD")+" )</li>":'<li class="progtrckr-todo">Attempted</li>',i+=n?'<li class="progtrckr-done">Delivered ( '+moment(n).format("YYYY-MM-DD")+" )</li></ol><br>":'<li class="progtrckr-todo">Delivered</li></ol></div><br>',$("#modalBodyReport").append(i),$("#loaderModal").addClass("hide"),$("#modalBodyReport").removeClass("hide")}$(document).ready(function(){localStorage.setItem("searchObj",JSON.stringify({originCity:"initial",invoiceNumber:"",LRNumber:"",from:"",to:"",selectStatus:"",customerNumber:""}));localStorage.setItem("objSorting",JSON.stringify({sortType:"initial",name:"",userId:"",getColomnIndex:""})),$("#page-loader").addClass("hide");window.location.protocol,window.location.host,window.location.href;var t=document.referrer;console.log("mainUrl : "+t);var e=getUrlParameter("id");console.log("customer_id : "+e);var r={customer_id:e,mainUrl:t,role:"user"};localStorage.setItem("customerObj",JSON.stringify(r)),$.ajax({url:"/embed/getRetailersById",type:"POST",datatype:"json",data:{userId:e,role:"user",mainUrl:t},async:!0,success:function(t){"Ok"===t.resCode?(updateUserWidgetValue(),updateTableValues(t.msg)):(console.log(t.msg),$("#tablecontainerDiv").html('<h1 style="text-align:center;">'+t.msg+"</h1>"),$("#page-loader").addClass("hide"))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})});