// when initial
// function dateToYMD(t){var e=t.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getFullYear();return(e<=9?"0"+e:e)+"-"+r+"-"+a}function getDate(){var t=new Date;return t.setDate(t.getDate()-1),t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()}function getReport(){var t=getDate();$.ajax({url:"/route/getReport",type:"GET",datatype:"json",async:!0,success:function(e){fileName="LR-Exception-Report_"+t+".csv","OK"==e.resCode?exportToCsv(fileName,e.msg):(alert(e.msg),console.log(e.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function exportToCsv(t,e){var r,a,o=function(t){var e="";return $.each(t,function(t,r){"invoice_no"!=t&&"local_inv_no"!=t&&"lr_no"!=t&&"customer_id"!=t&&"customer_name"!=t||(e+='"'+r+'"'+",")}),e+"\n"},s="";s+=(r=e[0],a="",$.each(r,function(t,e){"invoice_no"!=t&&"local_inv_no"!=t&&"lr_no"!=t&&"customer_id"!=t&&"customer_name"!=t||(a+=t+",")}),a+"\n");for(var n=0;n<e.length;n++)s+=o(e[n]);var i=new Blob([s],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,t);else{var l=document.createElement("a");if(void 0!==l.download){var d=URL.createObjectURL(i);l.setAttribute("href",d),l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}}function updateNotificationFunction(t){$(".updateNotification").click(function(e){var r,a=$(this).parents("tr").find("td:first span").html(),o=($(this).parents("tr").find("td:nth-child(2)").html(),$(this).parents("tr").find("td:nth-child(3)").html()),s=$(this).parents("tr").find("td:nth-child(4)").html(),n=$(this).parents("tr").find("td:nth-child(5)").html(),i=$(this).parents("tr").find("td:nth-child(6)").html(),l=$(this).parents("tr").find("td:nth-child(7)").html(),d=$(this).parents("tr").find("td:nth-child(8)").html(),c=$(this).parents("tr").find("td:nth-child(9)").html(),u=$(this).parents("tr").find("td:nth-child(10)").html(),m=$(this).parents("tr").find("td:nth-child(11)").html(),E=$(this).parents("tr").find("td:nth-child(12)").html(),h=$(this).parents("tr").find("td:nth-child(13)").html(),p="Tracking is now enabled on this critical shipment";for(r=0;r<t.length;r++)a==t[r].invoice_value&&(E=t[r].pod,h=t[r].notificationNew);if(null==h||(p="Are you sure you want to disable alerts on this shipment?"),1==confirm(p)){null==h&&(h=0);var T=JSON.parse(localStorage.getItem("user")),g={invoice_No:a,lr_No:s,customer_name:n,status_No:i,origin_No:l,destination_No:d,current_Location_No:c,date_Placed_No:u,assured_No:m,pod_No:E,order_no:o,notification_No:h,userId:T.user_id,role:T.role},D={userId:T.user_id,role:T.role};$.ajax({url:"/route/updateNotification",type:"POST",datatype:"json",data:g,async:!0,success:function(t){"Ok"===t.resCode?$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:D,async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}}):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}})}function updateTableValues(t){if($("#tablecontainerDiv").html(" "),$("#tablecontainerDiv").html("<table id='data-table' class='table table-striped table-bordered display'  cellspacing=0 width=100%><thead class='Table_header'><tr><th name='local_inv_no' onclick='myFunctionSorting(this)'>Invoice #</th><th name='po_number' onclick='myFunctionSorting(this)'>PO Code</th><th name='order_no' onclick='myFunctionSorting(this)'>Order No</th><th name='lr_no' onclick='myFunctionSorting(this)'>LR Number</th><th name='customer_name' onclick='myFunctionSorting(this)'>Customer Name</th><th name='order_status' onclick='myFunctionSorting(this)'>Status</th><th name='pickup_city' onclick='myFunctionSorting(this)'>Origin</th><th name='delivery_city' onclick='myFunctionSorting(this)'>Destination</th><th name='current_location' onclick='myFunctionSorting(this)'>Latest Location</th><th name='booked_datetime' onclick='myFunctionSorting(this)'>Date Of Dispatch</th><th name='assured_delivery_date' onclick='myFunctionSorting(this)'>Expected Delivery Date</th><th name='transport_name' onclick='myFunctionSorting(this)'>Transporter Name</th><th>Notification & Feedback</th></tr></thead><tbody class='aboutMeTable_body'></tbody></table></div></section>"),$.each(t,function(t,e){var r="<tr>";if(r+="<td class='trackDetails' data-toggle='modal' data-target='#modal-report' style='text-align: center;'><span class='editrowCss'>"+e.invoice_value+"</span></td>",e.po_number?r+="<td style='text-align: center;'>"+e.po_number+"</td>":r+="<td></td>",e.order_no?r+="<td style='text-align: center;'>"+e.order_no+"</td>":r+="<td></td>",r+="<td style='text-align: center;'>"+e.docket_number+"</td>",r+="<td style='text-align: center;'>"+e.customer_name+"</td>",e.status){"Delivered"==e.status||"Attempted"==e.status||"DELIVERED"==e.status||"ATTEMPTED"==e.status||(e.status="IN TRANSIT");var a=new Date;new Date(e.estimatedTimeOfArrival)<a&&"DELIVERED"!=e.status&&null!=e.estimatedTimeOfArrival&&"ATTEMPTED"!=e.status&&(e.status="DELAYED"),r+="<td style='text-align: center;'>"+e.status+"</td>"}else r+="<td style='text-align: center;'>Local Shipment in transit</td>";e.pickup_city?r+="<td style='text-align: center;'>"+e.pickup_city+"</td>":r+="<td></td>",e.delivery_city?r+="<td style='text-align: center;'>"+e.delivery_city+"</td>":r+="<td></td>",e.currentLocation.city?r+="<td style='text-align: center;'>"+e.currentLocation.city+"</td>":r+="<td style='text-align: center;'></td>",e.createdAt&&"0000-00-00 00:00:00"!=e.createdAt?r+="<td style='text-align: center;'>"+dateToYMD(new Date(e.createdAt))+"</td>":r+="<td></td>",e.estimatedTimeOfArrival&&"0000-00-00 00:00:00"!=e.estimatedTimeOfArrival?r+="<td style='text-align: center;'>"+dateToYMD(new Date(e.estimatedTimeOfArrival))+"</td>":r+="<td></td>",e.transport_name?r+="<td style='text-align: center;'>"+e.transport_name+"</td>":r+="<td></td>",null!=e.notificationNew?r+="<td style='text-align: center;'><span class='updateNotification alertAndFeedBackSpan' title='Notification'><i class='fa fa-envelope checked'></i></span><span class='marginLeft10 alertAndFeedBackSpan' title='Feedback'><a target= '_blank' href='https://goo.gl/forms/Fr33RtzyLwAicrkP2'><i class='fa fa-comments-o'></i></a></span></td>":r+="<td style='text-align: center;'><span class='updateNotification alertAndFeedBackSpan' title='Notification'><i class='fa fa-envelope'></i></span><span class='marginLeft10 alertAndFeedBackSpan' title='Feedback'><a target= '_blank' href='https://goo.gl/forms/Fr33RtzyLwAicrkP2'><i class='fa fa-comments-o'></i></a></span></td>",r+="</tr>",$("#data-table tbody").append(r)}),updateNotificationFunction(t),viewMoreFunction(t),"initial"!==(r=JSON.parse(localStorage.getItem("objSorting"))).sortType){var e=r.sortType;e="sorting_desc"===e?"desc":"asc",$("#data-table").DataTable({dom:"lBfrtip",buttons:[{extend:"copy",className:"btn-sm"},{extend:"csv",className:"btn-sm"},{extend:"excel",className:"btn-sm"},{extend:"pdf",className:"btn-sm"},{extend:"print",className:"btn-sm"}],responsive:0,scrollX:!0,autoFill:0,colReorder:0,keys:0,rowReorder:0,select:0,order:[[r.getColomnIndex,e]]}),localStorage.removeItem("objSorting");var r={sortType:"initial",name:"",userId:"",getColomnIndex:""};localStorage.setItem("objSorting",JSON.stringify(r))}else TableManageCombine.init();handlePageContentView()}function removeFilterFunction(){$("#invoiceNumber").val(""),$("#poCode").val(""),$("#orderNo").val(""),$("#LRNumber").val(""),$("#selectStatus").val(""),$("#selectTransporter").val(""),$("#originCity").val(""),$("#dateRangepicker-Dispatch").val(""),$("#dateRangepicker-Estimated").val(""),$("#customerNumber").val("");$("#selectStatus").find("option[value=]").prop("selected",!0).trigger("change"),$("#selectTransporter").find("option[value=]").prop("selected",!0).trigger("change"),$("#Filter").addClass("hide"),$("#page-loader").removeClass("hide"),user=JSON.parse(localStorage.getItem("user")),localStorage.removeItem("objSorting");var t={sortType:"initial",name:"",userId:"",getColomnIndex:""};localStorage.setItem("objSorting",JSON.stringify(t)),localStorage.setItem("searchObj",JSON.stringify(t)),$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:{userId:user.user_id,role:user.role},async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function searchFunction(){$("#page-loader").removeClass("hide");var t=$("#invoiceNumber").val(),e=$("#poCode").val(),r=$("#orderNo").val(),a=$("#LRNumber").val(),o=document.getElementById("selectStatus").value,s=document.getElementById("selectTransporter").value,n=$("#originCity").val(),i=$("#dateRangepicker-Dispatch").val(),l=$("#dateRangepicker-Estimated").val(),d=$("#customerNumber").val(),c=JSON.parse(localStorage.getItem("user"));(""!=e||""!=r||""!=n||""!=t||""!=a||""!=i||""!=l||""!=o&&"Status"!=o||""!=s&&"Transporter"!=s||""!=d)&&$("#Filter").removeClass("hide");var u={originCity:n,invoiceNumber:t,LRNumber:a,poCode:e,orderNo:r,selectTransporter:s,selectStatus:o,userId:c.user_id,customerNumber:d,dispatch:i,estimated:l,role:c.role};localStorage.setItem("searchObj",JSON.stringify(u)),$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:u,async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateUserWidgetValue(){var t=JSON.parse(localStorage.getItem("user")),e={userId:t.user_id,role:t.role};$.ajax({url:"/track/getUserTotalCount",type:"POST",datatype:"json",data:e,async:!0,success:function(t){"Ok"===t.resCode?updateUserWidgetValuesNew(t.msg):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateUserWidgetValuesNew(t){var e,r=0,a=0,o=0,s=0;for(e=0;e<t.length;e++)"IN TRANSIT"===t[e].order_status?r=t[e].shipment_count:"DELIVERED"===t[e].order_status?a=t[e].shipment_count:"OUT FOR DELIVERY"===t[e].order_status?t[e].shipment_count:"ATTEMPTED"===t[e].order_status&&(o=t[e].shipment_count),null!==t[e].order_status&&(s+=t[e].shipment_count),r=s-a;var n=JSON.parse(localStorage.getItem("user")),i={selectStatus:"DELAYED",userId:n.user_id,role:n.role};$.ajax({url:"/track/getDelayed",type:"POST",datatype:"json",data:i,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(s),$("#inTransitShipment").html(r),$("#deliveredShipment").html(a),$("#attemptedShipment").html(o),$("#delayedShipment").html(t.msg.length)}else alert(t.msg),console.log(t.msg)},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateAdminWidgetValues(){$.ajax({url:"/track/getAdminTotalCount",type:"POST",datatype:"json",data:{},async:!0,success:function(t){"Ok"===t.resCode?updateAdminWidgetValuesNew(t.msg):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateAdminWidgetValuesNew(t){var e,r=0,a=0,o=0,s=0;for(e=0;e<t.length;e++)"IN TRANSIT"===t[e].order_status?r=t[e].shipment_count:"DELIVERED"===t[e].order_status?a=t[e].shipment_count:"OUT FOR DELIVERY"===t[e].order_status?t[e].shipment_count:"ATTEMPTED"===t[e].order_status&&(o=t[e].shipment_count),null!==t[e].order_status&&(s+=t[e].shipment_count),r=s-a;var n=JSON.parse(localStorage.getItem("user")),i={selectStatus:"DELAYED",userId:n.user_id,role:n.role};$.ajax({url:"/track/getDelayed",type:"POST",datatype:"json",data:i,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(s),$("#inTransitShipment").html(r),$("#deliveredShipment").html(a),$("#attemptedShipment").html(o),$("#delayedShipment").html(t.msg.length)}else console.log(t.msg),$("#totalShipment").html(s),$("#inTransitShipment").html(r),$("#deliveredShipment").html(a),$("#attemptedShipment").html(o),$("#delayedShipment").html("0")},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateWidgetValues(t){var e,r,a=0,o=0,s=0;for(e=0;e<t.length;e++)"NEW"===t[e].status&&a++,"DELIVERED"===t[e].status&&s++,"NEW"!==t[e].status&&"DELIVERED"!==t[e].status&&o++;r=t.length;var n=JSON.parse(localStorage.getItem("user")),i={selectStatus:"DELAYED",userId:n.user_id,role:n.role};$.ajax({url:"/track/getDelayed",type:"POST",datatype:"json",data:i,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(r),$("#newShipment").html(a),$("#inTransitShipment").html(o),$("#deliveredShipment").html(s),$("#delayedShipment").html(t.msg.length)}else console.log(t.msg),$("#totalShipment").html(r),$("#newShipment").html(a),$("#inTransitShipment").html(o),$("#deliveredShipment").html(s),$("#delayedShipment").html("0")},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function myFunctionSorting(t){$("#page-loader").removeClass("hide");var e=$(t).attr("class");e="sorting"===e?"sorting_asc":"sorting_desc"===e?"sorting_asc":"sorting_desc";var r=$(t).attr("name"),a=JSON.parse(localStorage.getItem("user")),o=JSON.parse(localStorage.getItem("searchObj"));console.log("Debug searchObj : >>>>",o);var s=getColomnIndexFunction(r);if("initial"!=o.originCity)var n={sortType:e,name:r,userId:a.user_id,role:a.role,getColomnIndex:s,originCity:o.originCity,invoiceNumber:o.invoiceNumber,LRNumber:o.LRNumber,dispatch:o.dispatch,estimated:o.estimated,selectStatus:o.selectStatus,customerNumber:o.customerNumber};else n={sortType:e,name:r,userId:a.user_id,role:a.role,getColomnIndex:s};localStorage.setItem("objSorting",JSON.stringify(n)),$.ajax({url:"/track/applyDataTableSorting",type:"POST",datatype:"json",data:n,async:!0,success:function(t){"Ok"===t.resCode?(updateTableValues(t.msg),$("#page-loader").addClass("hide")):(alert(t.msg),console.log(t.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function getColomnIndexFunction(t){return"local_inv_no"===t?0:"po_number"===t?1:"order_no"===t?2:"lr_no"===t?3:"customer_name"===t?4:"order_status"===t?5:"pickup_city"===t?6:"delivery_city"===t?7:"current_location"===t?8:"booked_datetime"===t?9:"assured_delivery_date"===t?10:"transport_name"===t?11:"notification"===t?12:void 0}function modalBodyLoad(t){$("#modalBody").load("modal.html")}function modalBodyLoadIdc(t){$("#modalBodyIdc").load("modalIdc.html")}function statusMapping(t){return"ATTEMPTED"==(t=t.toUpperCase())||t.startsWith("ATTEMPTED ")?"ATTEMPTED":"ATTEMPTED-CHANGE OF DELIVERY ADDRESS"==t||t.startsWith("ATTEMPTED-CHANGE OF DELIVERY ADDRESS")?"ATTEMPTED":"ATTEMPTED-COMPANY CLOSED ON DELIVERY ATTEMPT"==t||t.startsWith("ATTEMPTED-COMPANY CLOSED ON DELIVERY ATTEMPT")?"ATTEMPTED":"ATTEMPTED-WRONG OR INCOMPLETE DELIVERY ADDRESS"==t||t.startsWith("ATTEMPTED-WRONG OR INCOMPLETE DELIVERY ADDRESS")?"ATTEMPTED":"DELIVERED"==t||t.startsWith("DELIVERED")?"DELIVERED":"DELIVERY ATTEMPTED"==t||t.startsWith("DELIVERY ATTEMPTED")?"ATTEMPTED":"FINAL LINE HAUL DEPARTED"==t||t.startsWith("FINAL LINE HAUL DEPARTED")?"IN TRANSIT":"NEW"==t||t.startsWith("NEW")?"IN TRANSIT":"ODA CON OUT FOR DELIVERY, FINAL STATUS AWAITED"==t||t.startsWith("ODA CON OUT FOR DELIVERY, FINAL STATUS AWAITED")?"OUT FOR DELIVERY":"OUT FOR DELIVERY"==t||t.startsWith("OUT FOR DELIVERY")?"OUT FOR DELIVERY":"OUTSCANNED"==t||t.startsWith("OUTSCANNED")?"IN TRANSIT":"RECEIVED AT DESTINATION DEPOT"==t||t.startsWith("RECEIVED AT DESTINATION DEPOT")?"IN TRANSIT":"RECEIVED AT DESTINATION DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY"==t||t.startsWith("RECEIVED AT DESTINATION DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY")?"IN TRANSIT":"RECEIVED AT DESTINATION DEPOT-REFUSED - DELIVERY RESCHEDULED BY CUSTOMER"==t||t.startsWith("RECEIVED AT DESTINATION DEPOT-REFUSED - DELIVERY RESCHEDULED BY CUSTOMER")?"IN TRANSIT":"RECEIVED AT TRANSIT DEPOT"==t||t.startsWith("RECEIVED AT TRANSIT DEPOT")?"IN TRANSIT":"RECEIVED AT TRANSIT DEPOT-EWAYBILL INVALID / WRONG TRANSPORTER ID"==t||t.startsWith("RECEIVED AT TRANSIT DEPOT-EWAYBILL INVALID / WRONG TRANSPORTER ID")?"IN TRANSIT":"RECEIVED AT TRANSIT DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY"==t||t.startsWith("RECEIVED AT TRANSIT DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY")?"IN TRANSIT":"CONSIGNMENT SORTED AND TRANSHIPPED"==t||t.startsWith("CONSIGNMENT SORTED AND TRANSHIPPED")?"IN TRANSIT":"DAMAGE DELIVERY"==t||t.startsWith("DAMAGE DELIVERY")?"IN TRANSIT":"OUTSCANNED"==t||t.startsWith("OUTSCANNED")?"IN TRANSIT":t}function viewMoreFunction(t){$(".trackDetails").click(function(e){$("#modalBodyReport").html(" ");for(var r=$(this).parents("tr").find("td:first").find("span").html(),a=($(this).parents("tr").find("td:nth-child(2)").html(),$(this).parents("tr").find("td:nth-child(4)").html()),o=($(this).parents("tr").find("td:nth-child(5)").html(),$(this).parents("tr").find("td:nth-child(6)").html(),{}),s=0;s<t.length;s++)if(t[s].invoice_value==r)o=t[s];$("#exampleModalLongTitle").html("View More About Invoice Number : "+r);var n;if($("#modalBodyReport").html('<div class="centerAlignDiv"><table style="width:50%;min-width:300px;" id="viewMoreTable" class="table-bordered table-striped"><tr></table></div>'),n+="<tr><th>Invoice Number</th><td>"+o.invoice_value+"</td></tr>",n+="<tr><th>PO Code</th><td>",o.po_number?n+=o.po_number+"</td></tr>":n+="</td></tr>",n+="<tr><th>Order No</th><td>",o.order_no?n+=o.order_no+"</td></tr>":n+="</td></tr>",n+="<tr><th>LR Number</th><td>"+o.docket_number+"</td></tr>",n+="<tr><th>Customer Name</th><td>"+o.customer_name+"</td></tr>",n+="<tr><th>Status</th><td>",o.status){"Delivered"==o.status||"Attempted"==o.status||"DELIVERED"==o.status||"ATTEMPTED"==o.status||(o.status="IN TRANSIT");var i=new Date;new Date(o.estimatedTimeOfArrival)<i&&"DELIVERED"!=o.status&&null!=o.estimatedTimeOfArrival&&"ATTEMPTED"!=o.status&&(o.status="DELAYED"),n+=o.status+"</td></tr>"}else n+="Local Shipment in transit</td></tr>";o.pickup_city?n+="<tr><th>Origin</th><td>"+o.pickup_city+"</td></tr>":n+="<tr><th>Origin</th><td></td></tr>",o.delivery_city?n+="<tr><th>Destination</th><td>"+o.delivery_city+"</td></tr>":n+="<tr><th>Destination</th><td></td></tr>",n+="<tr><th>Latest Location</th><td>",o.currentLocation.city?n+=o.currentLocation.city+"</td></tr>":n+="</td></tr>",n+="<tr><th>Date Of Dispatch</th><td>",o.createdAt&&"0000-00-00 00:00:00"!=o.createdAt?n+=dateToYMD(new Date(o.createdAt))+"</td></tr>":n+="</td></tr>",n+="<tr><th>Expected Delivery Date</th><td>",o.estimatedTimeOfArrival&&"0000-00-00 00:00:00"!=o.estimatedTimeOfArrival?n+=dateToYMD(new Date(o.estimatedTimeOfArrival))+"</td></tr>":n+="</td></tr>",n+="<tr><th>Transporter Name</th><td>",o.transport_name?n+=o.transport_name+"</td></tr>":n+="</td></tr>",n+="<tr><th>POD</th>",o.pod?n+="<td><a target= '_blank' href="+o.pod+">"+o.pod+"</a></td></tr>":n+="<td></td></tr>",n+="<tr><th>Remark</th><td>",o.remark?n+=o.remark+"</td></tr>":n+="</td></tr>",$("#viewMoreTable").append(n);var l={lr_No:a,CustomerCode:o.account_number};$.ajax({url:"/route/viewMoreAndTraceNew",type:"POST",datatype:"json",data:l,async:!0,success:function(t){if("OK"==t.resCode)updateTracking(t.track,o);else{var e='<br><div class="centerAlignDiv"><ol class="progtrckr" data-progtrckr-steps="4"><li class="progtrckr-done">Dispatch ( '+moment(o.createdAt).format("YYYY-MM-DD")+' )</li><li class="progtrckr-todo">In Transit</li><li class="progtrckr-todo">Attempted</li><li class="progtrckr-todo">Delivered</li></ol></div><br>';$("#modalBodyReport").append(e),$("#loaderModal").addClass("hide"),$("#modalBodyReport").removeClass("hide")}},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})})}function updateTracking(t,e){var r,a="",o="",s="",n="2000-10-23T03:13:00.000Z",i="";for(r=0;r<t.length;r++)"IN TRANSIT"===t[r].order_status||"ATTEMPTED"!=t[r].order_status&&"DELIVERED"!=t[r].order_status?a=t[r].last_delivery_status_date:"ATTEMPTED"===t[r].order_status?o=t[r].last_delivery_status_date:"DELIVERED"===t[r].order_status&&(s=t[r].last_delivery_status_date),new Date(t[r].last_delivery_status_date)>=new Date(n)&&(n=t[r].last_delivery_status_date,i=t[r].order_status);""!=s?""==o?(o=s,""==a&&(a=s)):""==a&&(a=o):""!=o&&""==a&&(a=o),"DELIVERED"==i||("ATTEMPTED"==i?s="":"IN TRANSIT"==i&&(s="",o=""));var l='<br><div class="centerAlignDiv"><ol class="progtrckr" data-progtrckr-steps="4"><li class="progtrckr-done">Dispatch ( '+moment(e.createdAt).format("YYYY-MM-DD")+" )</li>";l+=a?'<li class="progtrckr-done">In Transit ( '+moment(a).format("YYYY-MM-DD")+" )</li>":'<li class="progtrckr-todo">In Transit</li>',l+=o?'<li class="progtrckr-done">Attempted ( '+moment(o).format("YYYY-MM-DD")+" )</li>":'<li class="progtrckr-todo">Attempted</li>',l+=s?'<li class="progtrckr-done">Delivered ( '+moment(s).format("YYYY-MM-DD")+" )</li></ol><br>":'<li class="progtrckr-todo">Delivered</li></ol></div><br>',$("#modalBodyReport").append(l),$("#loaderModal").addClass("hide"),$("#modalBodyReport").removeClass("hide")}function modalBodyLoadLogs(t){$("#modalBodyLogs").load("modalLogs.html")}$(document).ready(function(){$("#page-loader").removeClass("hide");var t=JSON.parse(localStorage.getItem("user"));$(".hidden-xs").html(t.name),"admin"===t.role&&($(".customerNumberSearchDiv").removeClass("hide"),$(".downloadList").removeClass("hide")),$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:{userId:t.user_id,role:t.role},async:!0,success:function(e){"Ok"===e.resCode?("admin"==t.role?updateAdminWidgetValues():updateUserWidgetValue(),updateTableValues(e.msg)):(alert(e.msg),console.log(e.msg))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})});

// When Not initial
function dateToYMD(t){var e=t.getDate(),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],r=t.getFullYear();return(e<=9?"0"+e:e)+"-"+a+"-"+r}function getDate(){var t=new Date;return t.setDate(t.getDate()-1),t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()}function getReport(){var t=getDate();$.ajax({url:"/route/getReport",type:"GET",datatype:"json",async:!0,success:function(e){fileName="LR-Exception-Report_"+t+".csv","OK"==e.resCode?exportToCsv(fileName,e.msg):(alert(e.msg),console.log(e.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function exportToCsv(t,e){var a,r,o=function(t){var e="";return $.each(t,function(t,a){"invoice_no"!=t&&"local_inv_no"!=t&&"lr_no"!=t&&"customer_id"!=t&&"customer_name"!=t||(e+='"'+a+'"'+",")}),e+"\n"},n="";n+=(a=e[0],r="",$.each(a,function(t,e){"invoice_no"!=t&&"local_inv_no"!=t&&"lr_no"!=t&&"customer_id"!=t&&"customer_name"!=t||(r+=t+",")}),r+"\n");for(var s=0;s<e.length;s++)n+=o(e[s]);var i=new Blob([n],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,t);else{var l=document.createElement("a");if(void 0!==l.download){var d=URL.createObjectURL(i);l.setAttribute("href",d),l.setAttribute("download",t),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}}}function updateNotificationFunction(t){$(".updateNotification").click(function(e){var a,r=$(this).parents("tr").find("td:first span").html(),o=($(this).parents("tr").find("td:nth-child(2)").html(),$(this).parents("tr").find("td:nth-child(3)").html()),n=$(this).parents("tr").find("td:nth-child(4)").html(),s=$(this).parents("tr").find("td:nth-child(5)").html(),i=$(this).parents("tr").find("td:nth-child(6)").html(),l=$(this).parents("tr").find("td:nth-child(7)").html(),d=$(this).parents("tr").find("td:nth-child(8)").html(),c=$(this).parents("tr").find("td:nth-child(9)").html(),u=$(this).parents("tr").find("td:nth-child(10)").html(),m=$(this).parents("tr").find("td:nth-child(11)").html(),E=$(this).parents("tr").find("td:nth-child(12)").html(),h=$(this).parents("tr").find("td:nth-child(13)").html(),p="Tracking is now enabled on this critical shipment";for(a=0;a<t.length;a++)r==t[a].invoice_value&&(E=t[a].pod,h=t[a].notificationNew);if(null==h||(p="Are you sure you want to disable alerts on this shipment?"),1==confirm(p)){null==h&&(h=0);var T=JSON.parse(localStorage.getItem("user")),g={invoice_No:r,lr_No:n,customer_name:s,status_No:i,origin_No:l,destination_No:d,current_Location_No:c,date_Placed_No:u,assured_No:m,pod_No:E,order_no:o,notification_No:h,userId:T.user_id,role:T.role},D={userId:T.user_id,role:T.role};$.ajax({url:"/route/updateNotification",type:"POST",datatype:"json",data:g,async:!0,success:function(t){"Ok"===t.resCode?$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:D,async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}}):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}})}function updateTableValues(t){if($("#tablecontainerDiv").html(" "),$("#tablecontainerDiv").html("<table id='data-table' class='table table-striped table-bordered display'  cellspacing=0 width=100%><thead class='Table_header'><tr><th name='local_inv_no' onclick='myFunctionSorting(this)'>Invoice #</th><th name='po_number' onclick='myFunctionSorting(this)'>PO Code</th><th name='order_no' onclick='myFunctionSorting(this)'>Order No</th><th name='lr_no' onclick='myFunctionSorting(this)'>LR Number</th><th name='customer_name' onclick='myFunctionSorting(this)'>Customer Name</th><th name='order_status' onclick='myFunctionSorting(this)'>Status</th><th name='pickup_city' onclick='myFunctionSorting(this)'>Origin</th><th name='delivery_city' onclick='myFunctionSorting(this)'>Destination</th><th name='current_location' onclick='myFunctionSorting(this)'>Latest Location</th><th name='booked_datetime' onclick='myFunctionSorting(this)'>Date Of Dispatch</th><th name='assured_delivery_date' onclick='myFunctionSorting(this)'>Expected Delivery Date</th><th name='actual_delivery_date' onclick='myFunctionSorting(this)'>Actual Delivery Date</th><th name='transport_name' onclick='myFunctionSorting(this)'>Transporter Name</th><th>Notification & Feedback</th></tr></thead><tbody class='aboutMeTable_body'></tbody></table></div></section>"),$.each(t,function(t,e){var a="<tr>";if(a+="<td class='trackDetails' data-toggle='modal' data-target='#modal-report' style='text-align: center;'><span class='editrowCss'>"+e.invoice_value+"</span></td>",e.po_number?a+="<td style='text-align: center;'>"+e.po_number+"</td>":a+="<td></td>",e.order_no?a+="<td style='text-align: center;'>"+e.order_no+"</td>":a+="<td></td>",a+="<td style='text-align: center;'>"+e.docket_number+"</td>",a+="<td style='text-align: center;'>"+e.customer_name+"</td>",e.status){"Delivered"==e.status||"Attempted"==e.status||"DELIVERED"==e.status||"ATTEMPTED"==e.status||(e.status="IN TRANSIT");var r=new Date;e.actual_delivery_date&&"SAFEX"!=e.transport_name&&"SPOTON"!=e.transport_name?e.status="DELIVERED":new Date(e.estimatedTimeOfArrival)<r&&"DELIVERED"!=e.status&&null!=e.estimatedTimeOfArrival&&"ATTEMPTED"!=e.status&&(e.status="DELAYED"),a+="<td style='text-align: center;'>"+e.status+"</td>"}else e.actual_delivery_date&&"SAFEX"!=e.transport_name&&"SPOTON"!=e.transport_name?a+="<td style='text-align: center;'>DELIVERED</td>":a+="<td style='text-align: center;'>Local Shipment in transit</td>";e.pickup_city?a+="<td style='text-align: center;'>"+e.pickup_city+"</td>":a+="<td></td>",e.delivery_city?a+="<td style='text-align: center;'>"+e.delivery_city+"</td>":a+="<td></td>",e.currentLocation.city?a+="<td style='text-align: center;'>"+e.currentLocation.city+"</td>":a+="<td style='text-align: center;'></td>",e.createdAt&&"0000-00-00 00:00:00"!=e.createdAt?a+="<td style='text-align: center;'>"+dateToYMD(new Date(e.createdAt))+"</td>":a+="<td></td>",e.estimatedTimeOfArrival&&"0000-00-00 00:00:00"!=e.estimatedTimeOfArrival?a+="<td style='text-align: center;'>"+dateToYMD(new Date(e.estimatedTimeOfArrival))+"</td>":a+="<td></td>",e.actual_delivery_date&&"0000-00-00 00:00:00"!=e.actual_delivery_date?a+="<td style='text-align: center;'>"+dateToYMD(new Date(e.actual_delivery_date))+"</td>":a+="<td></td>",e.transport_name?a+="<td style='text-align: center;'>"+e.transport_name+"</td>":a+="<td></td>",null!=e.notificationNew?a+="<td style='text-align: center;'><span class='updateNotification alertAndFeedBackSpan' title='Notification'><i class='fa fa-envelope checked'></i></span><span class='marginLeft10 alertAndFeedBackSpan' title='Feedback'><a target= '_blank' href='https://goo.gl/forms/Fr33RtzyLwAicrkP2'><i class='fa fa-comments-o'></i></a></span></td>":a+="<td style='text-align: center;'><span class='updateNotification alertAndFeedBackSpan' title='Notification'><i class='fa fa-envelope'></i></span><span class='marginLeft10 alertAndFeedBackSpan' title='Feedback'><a target= '_blank' href='https://goo.gl/forms/Fr33RtzyLwAicrkP2'><i class='fa fa-comments-o'></i></a></span></td>",a+="</tr>",$("#data-table tbody").append(a)}),updateNotificationFunction(t),viewMoreFunction(t),"initial"!==(a=JSON.parse(localStorage.getItem("objSorting"))).sortType){var e=a.sortType;e="sorting_desc"===e?"desc":"asc",$("#data-table").DataTable({dom:"lBfrtip",buttons:[{extend:"copy",className:"btn-sm"},{extend:"csv",className:"btn-sm"},{extend:"excel",className:"btn-sm"},{extend:"pdf",className:"btn-sm"},{extend:"print",className:"btn-sm"}],responsive:0,scrollX:!0,autoFill:0,colReorder:0,keys:0,rowReorder:0,select:0,order:[[a.getColomnIndex,e]]}),localStorage.removeItem("objSorting");var a={sortType:"initial",name:"",userId:"",getColomnIndex:""};localStorage.setItem("objSorting",JSON.stringify(a))}else TableManageCombine.init();handlePageContentView()}function removeFilterFunction(){$("#invoiceNumber").val(""),$("#poCode").val(""),$("#orderNo").val(""),$("#LRNumber").val(""),$("#selectStatus").val(""),$("#selectTransporter").val(""),$("#originCity").val(""),$("#dateRangepicker-Dispatch").val(""),$("#dateRangepicker-Estimated").val(""),$("#customerNumber").val("");$("#selectStatus").find("option[value=]").prop("selected",!0).trigger("change"),$("#selectTransporter").find("option[value=]").prop("selected",!0).trigger("change"),$("#Filter").addClass("hide"),$("#page-loader").removeClass("hide"),user=JSON.parse(localStorage.getItem("user")),localStorage.removeItem("objSorting");var t={sortType:"initial",name:"",userId:"",getColomnIndex:""};localStorage.setItem("objSorting",JSON.stringify(t)),localStorage.setItem("searchObj",JSON.stringify(t)),$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:{userId:user.user_id,role:user.role},async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function searchFunction(){$("#page-loader").removeClass("hide");var t=$("#invoiceNumber").val(),e=$("#poCode").val(),a=$("#orderNo").val(),r=$("#LRNumber").val(),o=document.getElementById("selectStatus").value,n=document.getElementById("selectTransporter").value,s=$("#originCity").val(),i=$("#dateRangepicker-Dispatch").val(),l=$("#dateRangepicker-Estimated").val(),d=$("#customerNumber").val(),c=JSON.parse(localStorage.getItem("user"));(""!=e||""!=a||""!=s||""!=t||""!=r||""!=i||""!=l||""!=o&&"Status"!=o||""!=n&&"Transporter"!=n||""!=d)&&$("#Filter").removeClass("hide");var u={originCity:s,invoiceNumber:t,LRNumber:r,poCode:e,orderNo:a,selectTransporter:n,selectStatus:o,userId:c.user_id,customerNumber:d,dispatch:i,estimated:l,role:c.role};localStorage.setItem("searchObj",JSON.stringify(u)),$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:u,async:!0,success:function(t){"Ok"===t.resCode?updateTableValues(t.msg):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateUserWidgetValue(){var t=JSON.parse(localStorage.getItem("user")),e={userId:t.user_id,role:t.role};$.ajax({url:"/track/getUserTotalCount",type:"POST",datatype:"json",data:e,async:!0,success:function(t){"Ok"===t.resCode?updateUserWidgetValuesNew(t.msg):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateUserWidgetValuesNew(t){var e,a=0,r=0,o=0,n=0;for(e=0;e<t.length;e++)"IN TRANSIT"===t[e].order_status?a=t[e].shipment_count:"DELIVERED"===t[e].order_status?r=t[e].shipment_count:"OUT FOR DELIVERY"===t[e].order_status?t[e].shipment_count:"ATTEMPTED"===t[e].order_status&&(o=t[e].shipment_count),null!==t[e].order_status&&(n+=t[e].shipment_count),a=n-r;var s=JSON.parse(localStorage.getItem("user")),i={selectStatus:"DELAYED",userId:s.user_id,role:s.role};$.ajax({url:"/track/getDelayed",type:"POST",datatype:"json",data:i,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(n),$("#inTransitShipment").html(a),$("#deliveredShipment").html(r),$("#attemptedShipment").html(o),$("#delayedShipment").html(t.msg.length)}else alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3)},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateAdminWidgetValues(){$.ajax({url:"/track/getAdminTotalCount",type:"POST",datatype:"json",data:{},async:!0,success:function(t){"Ok"===t.resCode?updateAdminWidgetValuesNew(t.msg):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateAdminWidgetValuesNew(t){var e,a=0,r=0,o=0,n=0;for(e=0;e<t.length;e++)"IN TRANSIT"===t[e].order_status?a=t[e].shipment_count:"DELIVERED"===t[e].order_status?r=t[e].shipment_count:"OUT FOR DELIVERY"===t[e].order_status?t[e].shipment_count:"ATTEMPTED"===t[e].order_status&&(o=t[e].shipment_count),null!==t[e].order_status&&(n+=t[e].shipment_count),a=n-r;var s=JSON.parse(localStorage.getItem("user")),i={selectStatus:"DELAYED",userId:s.user_id,role:s.role};$.ajax({url:"/track/getDelayed",type:"POST",datatype:"json",data:i,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(n),$("#inTransitShipment").html(a),$("#deliveredShipment").html(r),$("#attemptedShipment").html(o),$("#delayedShipment").html(t.msg.length)}else console.log(t.msg),$("#totalShipment").html(n),$("#inTransitShipment").html(a),$("#deliveredShipment").html(r),$("#attemptedShipment").html(o),$("#delayedShipment").html("0"),setTimeout(function(){location.replace("./dashboard")},2e3)},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function updateWidgetValues(t){var e,a,r=0,o=0,n=0;for(e=0;e<t.length;e++)"NEW"===t[e].status&&r++,"DELIVERED"===t[e].status&&n++,"NEW"!==t[e].status&&"DELIVERED"!==t[e].status&&o++;a=t.length;var s=JSON.parse(localStorage.getItem("user")),i={selectStatus:"DELAYED",userId:s.user_id,role:s.role};$.ajax({url:"/track/getDelayed",type:"POST",datatype:"json",data:i,async:!0,success:function(t){if("Ok"===t.resCode){t.msg.length;$("#totalShipment").html(a),$("#newShipment").html(r),$("#inTransitShipment").html(o),$("#deliveredShipment").html(n),$("#delayedShipment").html(t.msg.length)}else console.log(t.msg),$("#totalShipment").html(a),$("#newShipment").html(r),$("#inTransitShipment").html(o),$("#deliveredShipment").html(n),$("#delayedShipment").html("0"),setTimeout(function(){location.replace("./dashboard")},2e3)},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function myFunctionSorting(t){$("#page-loader").removeClass("hide");var e=$(t).attr("class");e="sorting"===e?"sorting_asc":"sorting_desc"===e?"sorting_asc":"sorting_desc";var a=$(t).attr("name"),r=JSON.parse(localStorage.getItem("user")),o=JSON.parse(localStorage.getItem("searchObj"));console.log("Debug searchObj : >>>>",o);var n=getColomnIndexFunction(a);if("initial"!=o.originCity)var s={sortType:e,name:a,userId:r.user_id,role:r.role,getColomnIndex:n,originCity:o.originCity,invoiceNumber:o.invoiceNumber,LRNumber:o.LRNumber,dispatch:o.dispatch,estimated:o.estimated,selectStatus:o.selectStatus,customerNumber:o.customerNumber};else s={sortType:e,name:a,userId:r.user_id,role:r.role,getColomnIndex:n};localStorage.setItem("objSorting",JSON.stringify(s)),$.ajax({url:"/track/applyDataTableSorting",type:"POST",datatype:"json",data:s,async:!0,success:function(t){"Ok"===t.resCode?(updateTableValues(t.msg),$("#page-loader").addClass("hide")):(alert(t.msg),console.log(t.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})}function getColomnIndexFunction(t){return"local_inv_no"===t?0:"po_number"===t?1:"order_no"===t?2:"lr_no"===t?3:"customer_name"===t?4:"order_status"===t?5:"pickup_city"===t?6:"delivery_city"===t?7:"current_location"===t?8:"booked_datetime"===t?9:"assured_delivery_date"===t?10:"actual_delivery_date"===t?11:"transport_name"===t?12:"notification"===t?13:void 0}function modalBodyLoad(t){$("#modalBody").load("modal.html")}function modalBodyLoadIdc(t){$("#modalBodyIdc").load("modalIdc.html")}function statusMapping(t){return"ATTEMPTED"==(t=t.toUpperCase())||t.startsWith("ATTEMPTED ")?"ATTEMPTED":"ATTEMPTED-CHANGE OF DELIVERY ADDRESS"==t||t.startsWith("ATTEMPTED-CHANGE OF DELIVERY ADDRESS")?"ATTEMPTED":"ATTEMPTED-COMPANY CLOSED ON DELIVERY ATTEMPT"==t||t.startsWith("ATTEMPTED-COMPANY CLOSED ON DELIVERY ATTEMPT")?"ATTEMPTED":"ATTEMPTED-WRONG OR INCOMPLETE DELIVERY ADDRESS"==t||t.startsWith("ATTEMPTED-WRONG OR INCOMPLETE DELIVERY ADDRESS")?"ATTEMPTED":"DELIVERED"==t||t.startsWith("DELIVERED")?"DELIVERED":"DELIVERY ATTEMPTED"==t||t.startsWith("DELIVERY ATTEMPTED")?"ATTEMPTED":"FINAL LINE HAUL DEPARTED"==t||t.startsWith("FINAL LINE HAUL DEPARTED")?"IN TRANSIT":"NEW"==t||t.startsWith("NEW")?"IN TRANSIT":"ODA CON OUT FOR DELIVERY, FINAL STATUS AWAITED"==t||t.startsWith("ODA CON OUT FOR DELIVERY, FINAL STATUS AWAITED")?"OUT FOR DELIVERY":"OUT FOR DELIVERY"==t||t.startsWith("OUT FOR DELIVERY")?"OUT FOR DELIVERY":"OUTSCANNED"==t||t.startsWith("OUTSCANNED")?"IN TRANSIT":"RECEIVED AT DESTINATION DEPOT"==t||t.startsWith("RECEIVED AT DESTINATION DEPOT")?"IN TRANSIT":"RECEIVED AT DESTINATION DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY"==t||t.startsWith("RECEIVED AT DESTINATION DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY")?"IN TRANSIT":"RECEIVED AT DESTINATION DEPOT-REFUSED - DELIVERY RESCHEDULED BY CUSTOMER"==t||t.startsWith("RECEIVED AT DESTINATION DEPOT-REFUSED - DELIVERY RESCHEDULED BY CUSTOMER")?"IN TRANSIT":"RECEIVED AT TRANSIT DEPOT"==t||t.startsWith("RECEIVED AT TRANSIT DEPOT")?"IN TRANSIT":"RECEIVED AT TRANSIT DEPOT-EWAYBILL INVALID / WRONG TRANSPORTER ID"==t||t.startsWith("RECEIVED AT TRANSIT DEPOT-EWAYBILL INVALID / WRONG TRANSPORTER ID")?"IN TRANSIT":"RECEIVED AT TRANSIT DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY"==t||t.startsWith("RECEIVED AT TRANSIT DEPOT-RECEIVER REFUSED TO ACCEPT DELIVERY")?"IN TRANSIT":"CONSIGNMENT SORTED AND TRANSHIPPED"==t||t.startsWith("CONSIGNMENT SORTED AND TRANSHIPPED")?"IN TRANSIT":"DAMAGE DELIVERY"==t||t.startsWith("DAMAGE DELIVERY")?"IN TRANSIT":"OUTSCANNED"==t||t.startsWith("OUTSCANNED")?"IN TRANSIT":t}function viewMoreFunction(t){$(".trackDetails").click(function(e){$("#modalBodyReport").html(" ");for(var a=$(this).parents("tr").find("td:first").find("span").html(),r=($(this).parents("tr").find("td:nth-child(2)").html(),$(this).parents("tr").find("td:nth-child(4)").html()),o=($(this).parents("tr").find("td:nth-child(5)").html(),$(this).parents("tr").find("td:nth-child(6)").html(),{}),n=0;n<t.length;n++)if(t[n].invoice_value==a)o=t[n];$("#exampleModalLongTitle").html("View More About Invoice Number : "+a);var s;if($("#modalBodyReport").html('<div class="centerAlignDiv"><table style="width:50%;min-width:300px;" id="viewMoreTable" class="table-bordered table-striped"><tr></table></div>'),s+="<tr><th>Invoice Number</th><td>"+o.invoice_value+"</td></tr>",s+="<tr><th>PO Code</th><td>",o.po_number?s+=o.po_number+"</td></tr>":s+="</td></tr>",s+="<tr><th>Order No</th><td>",o.order_no?s+=o.order_no+"</td></tr>":s+="</td></tr>",s+="<tr><th>LR Number</th><td>"+o.docket_number+"</td></tr>",s+="<tr><th>Customer Name</th><td>"+o.customer_name+"</td></tr>",s+="<tr><th>Status</th><td>",o.status){"Delivered"==o.status||"Attempted"==o.status||"DELIVERED"==o.status||"ATTEMPTED"==o.status||(o.status="IN TRANSIT");var i=new Date;o.actual_delivery_date&&"SAFEX"!=o.transport_name&&"SPOTON"!=o.transport_name?o.status="DELIVERED":new Date(o.estimatedTimeOfArrival)<i&&"DELIVERED"!=o.status&&null!=o.estimatedTimeOfArrival&&"ATTEMPTED"!=o.status&&(o.status="DELAYED"),s+=o.status+"</td></tr>"}else o.actual_delivery_date&&"SAFEX"!=o.transport_name&&"SPOTON"!=o.transport_name?s+="DELIVERED</td></tr>":s+="Local Shipment in transit</td></tr>";o.pickup_city?s+="<tr><th>Origin</th><td>"+o.pickup_city+"</td></tr>":s+="<tr><th>Origin</th><td></td></tr>",o.delivery_city?s+="<tr><th>Destination</th><td>"+o.delivery_city+"</td></tr>":s+="<tr><th>Destination</th><td></td></tr>",s+="<tr><th>Latest Location</th><td>",o.currentLocation.city?s+=o.currentLocation.city+"</td></tr>":s+="</td></tr>",s+="<tr><th>Date Of Dispatch</th><td>",o.createdAt&&"0000-00-00 00:00:00"!=o.createdAt?s+=dateToYMD(new Date(o.createdAt))+"</td></tr>":s+="</td></tr>",s+="<tr><th>Expected Delivery Date</th><td>",o.estimatedTimeOfArrival&&"0000-00-00 00:00:00"!=o.estimatedTimeOfArrival?s+=dateToYMD(new Date(o.estimatedTimeOfArrival))+"</td></tr>":s+="</td></tr>",s+="<tr><th>Actual Delivery Date</th><td>",o.actual_delivery_date&&"0000-00-00 00:00:00"!=o.actual_delivery_date?s+=dateToYMD(new Date(o.actual_delivery_date))+"</td></tr>":s+="</td></tr>",s+="<tr><th>Transporter Name</th><td>",o.transport_name?s+=o.transport_name+"</td></tr>":s+="</td></tr>",s+="<tr><th>POD</th>",o.pod?s+="<td><a target= '_blank' href="+o.pod+">"+o.pod+"</a></td></tr>":s+="<td></td></tr>",s+="<tr><th>Remark</th><td>",o.remark?s+=o.remark+"</td></tr>":s+="</td></tr>",$("#viewMoreTable").append(s);var l={lr_No:r,CustomerCode:o.account_number};$.ajax({url:"/route/viewMoreAndTraceNew",type:"POST",datatype:"json",data:l,async:!0,success:function(t){if("OK"==t.resCode)updateTracking(t.track,o);else{var e='<br><div class="centerAlignDiv"><ol class="progtrckr" data-progtrckr-steps="4"><li class="progtrckr-done">Dispatch ( '+moment(o.createdAt).format("YYYY-MM-DD")+' )</li><li class="progtrckr-todo">In Transit</li><li class="progtrckr-todo">Attempted</li><li class="progtrckr-todo">Delivered</li></ol></div><br>';$("#modalBodyReport").append(e),$("#loaderModal").addClass("hide"),$("#modalBodyReport").removeClass("hide")}},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})})}function updateTracking(t,e){var a,r="",o="",n="",s="2000-10-23T03:13:00.000Z",i="";for(a=0;a<t.length;a++)"IN TRANSIT"===t[a].order_status||"ATTEMPTED"!=t[a].order_status&&"DELIVERED"!=t[a].order_status?r=t[a].last_delivery_status_date:"ATTEMPTED"===t[a].order_status?o=t[a].last_delivery_status_date:"DELIVERED"===t[a].order_status&&(n=t[a].last_delivery_status_date),new Date(t[a].last_delivery_status_date)>=new Date(s)&&(s=t[a].last_delivery_status_date,i=t[a].order_status);e.actual_delivery_date&&"SAFEX"!=e.transport_name&&"SPOTON"!=e.transport_name&&(n=e.actual_delivery_date),""!=n?""==o||"0000-00-00 00:00:00"==o?(o=n,""!=r&&"0000-00-00 00:00:00"!=r||(r=n)):""!=r&&"0000-00-00 00:00:00"!=r||(r=o):""!=o&&(""!=r&&"0000-00-00 00:00:00"!=r||(r=o)),"DELIVERED"==i||("ATTEMPTED"==i?n="":"IN TRANSIT"==i&&(n="",o=""));var l='<br><div class="centerAlignDiv"><ol class="progtrckr" data-progtrckr-steps="4"><li class="progtrckr-done">Dispatch ( '+moment(e.createdAt).format("YYYY-MM-DD")+" )</li>";l+=r?'<li class="progtrckr-done">In Transit ( '+moment(r).format("YYYY-MM-DD")+" )</li>":'<li class="progtrckr-todo">In Transit</li>',l+=o?'<li class="progtrckr-done">Attempted ( '+moment(o).format("YYYY-MM-DD")+" )</li>":'<li class="progtrckr-todo">Attempted</li>',l+=n?'<li class="progtrckr-done">Delivered ( '+moment(n).format("YYYY-MM-DD")+" )</li></ol><br>":'<li class="progtrckr-todo">Delivered</li></ol></div><br>',$("#modalBodyReport").append(l),$("#loaderModal").addClass("hide"),$("#modalBodyReport").removeClass("hide")}function modalBodyLoadLogs(t){$("#modalBodyLogs").load("modalLogs.html")}$(document).ready(function(){$("#page-loader").removeClass("hide");var t=JSON.parse(localStorage.getItem("user"));$(".hidden-xs").html(t.name),"admin"===t.role&&($(".customerNumberSearchDiv").removeClass("hide"),$(".downloadList").removeClass("hide")),$.ajax({url:"/track/getRetailers",type:"POST",datatype:"json",data:{userId:t.user_id,role:t.role},async:!0,success:function(e){"Ok"===e.resCode?("admin"==t.role?updateAdminWidgetValues():updateUserWidgetValue(),updateTableValues(e.msg)):(alert(e.msg),console.log(e.msg),setTimeout(function(){location.replace("./dashboard")},2e3))},error:function(t){console.log("Error executing AJAX request. Please contact your administrator")}})});